{# templates/admin/reports_sales.html #}
{% extends "admin/base_site.html" %}
{% load static %}
{% block content %}
<h1>Reportes de ventas</h1>

<form method="get" class="row g-2 mb-3">
  <div class="col-auto">
    <label>Desde</label>
    <input type="date" name="start" value="{{ start }}" class="form-control">
  </div>
  <div class="col-auto">
    <label>Hasta</label>
    <input type="date" name="end" value="{{ end }}" class="form-control">
  </div>
  <div class="col-auto align-self-end">
    <button class="btn btn-primary">Aplicar</button>
    <a class="btn btn-outline-secondary" href="?export=pdf&start={{ start }}&end={{ end }}">Exportar PDF</a>
  </div>
</form>

<div class="row">
  <div class="col-md-4">
    <h3>Ventas totales</h3>
    <p style="font-size:1.4rem;"><strong>${{ ventas_total|floatformat:2 }}</strong></p>
  </div>
  <div class="col-md-4">
    <h3>Pedidos</h3>
    <p style="font-size:1.4rem;"><strong>{{ cantidad_pedidos }}</strong></p>
  </div>
  <div class="col-md-4">
    <h3>Ganancia estimada</h3>
    <p style="font-size:1.4rem;"><strong>${{ ganancia_total|floatformat:2 }}</strong></p>
  </div>
</div>

<hr>

<h3>Ventas por semanas</h3>
<table class="table table-striped">
  <thead>
    <tr><th>Semana</th><th>Total</th></tr>
  </thead>
  <tbody>
    {% for w in weeks %}
    <tr>
      <td>{{ w.start }} → {{ w.end }}</td>
      <td>${{ w.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr>

<h3>Productos más vendidos</h3>
<table class="table table-sm">
  <thead>
    <tr><th>ID</th><th>Producto</th><th>Cantidad</th></tr>
  </thead>
  <tbody>
    {% for row in top_products_page %}
    <tr>
      <td>{{ row.producto.pk }}</td>
      <td>{{ row.producto.nombre }}</td>
      <td>{{ row.cantidad }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="3">No hay productos vendidos en este período.</td></tr>
    {% endfor %}
  </tbody>
</table>

<nav aria-label="Page navigation">
  <ul class="pagination">
    {% if top_products_page.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ top_products_page.previous_page_number }}&start={{ start }}&end={{ end }}">«</a></li>
    {% endif %}
    <li class="page-item disabled"><span class="page-link">Página {{ top_products_page.number }}</span></li>
    {% if top_products_page.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ top_products_page.next_page_number }}&start={{ start }}&end={{ end }}">»</a></li>
    {% endif %}
  </ul>
</nav>

{% endblock %}
