{% extends "admin/base_site.html" %}
{% load static %}
{% block content %}

<!-- Header del reporte -->
<div class="mb-4">
  <h1 class="display-6 fw-bold mb-1">üìä Reportes de Ventas</h1>
  <p class="text-muted mb-0">An√°lisis detallado de tu desempe√±o comercial</p>
</div>

<!-- Filtros de fecha -->
<div class="card mb-4 shadow-custom">
  <div class="card-body">
    <form method="get" class="row g-3 align-items-end">
      <div class="col-md-4 col-lg-3">
        <label for="start-date" class="form-label fw-600 text-uppercase small letter-spacing">Desde</label>
        <input type="date" id="start-date" name="start" value="{{ start }}" class="form-control">
      </div>
      <div class="col-md-4 col-lg-3">
        <label for="end-date" class="form-label fw-600 text-uppercase small letter-spacing">Hasta</label>
        <input type="date" id="end-date" name="end" value="{{ end }}" class="form-control">
      </div>
      <div class="col-md-4 col-lg-6 d-flex gap-2">
        <button type="submit" class="btn btn-primary flex-grow-1">
          ‚úì Aplicar Filtro
        </button>
        <a href="{% url 'reports:export_pdf' %}?start={{ start|date:'Y-m-d' }}&end={{ end|date:'Y-m-d' }}"
          target="_blank" class="btn btn-outline-danger">
          üì• Exportar PDF
        </a>
      </div>
    </form>
  </div>
</div>

<!-- KPIs Principales -->
<div class="row g-3 mb-4">
  <div class="col-md-6 col-lg-4">
    <div class="card h-100 shadow-custom">
      <div class="card-body">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <p class="text-muted small fw-600 text-uppercase letter-spacing mb-2">Ventas Totales</p>
            <h3 class="fw-bold mb-0" style="color: #b51f24; font-size: 2rem;">${{ ventas_total|floatformat:2 }}</h3>
          </div>
          <span style="font-size: 2.5rem;">üí∞</span>
        </div>
        <hr class="my-3" style="border-color: #2a2a2a;">
        <small class="text-muted">Per√≠odo seleccionado</small>
      </div>
    </div>
  </div>

  <div class="col-md-6 col-lg-4">
    <div class="card h-100 shadow-custom">
      <div class="card-body">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <p class="text-muted small fw-600 text-uppercase letter-spacing mb-2">Pedidos</p>
            <h3 class="fw-bold mb-0" style="color: #b51f24; font-size: 2rem;">{{ cantidad_pedidos }}</h3>
          </div>
          <span style="font-size: 2.5rem;">üì¶</span>
        </div>
        <hr class="my-3" style="border-color: #2a2a2a;">
        <small class="text-muted">Total de √≥rdenes</small>
      </div>
    </div>
  </div>

  <div class="col-md-6 col-lg-4">
    <div class="card h-100 shadow-custom">
      <div class="card-body">
        <div class="d-flex align-items-start justify-content-between">
          <div>
            <p class="text-muted small fw-600 text-uppercase letter-spacing mb-2">Ganancia Estimada</p>
            <h3 class="fw-bold mb-0" style="color: #b51f24; font-size: 2rem;">${{ ganancia_total|floatformat:2 }}</h3>
          </div>
          <span style="font-size: 2.5rem;">üìà</span>
        </div>
        <hr class="my-3" style="border-color: #2a2a2a;">
        <small class="text-muted">Utilidad neta</small>
      </div>
    </div>
  </div>
</div>

<!-- Ventas por semanas -->
<div class="card mb-4 shadow-custom">
  <div class="card-header" style="background: #000; border-bottom: 2px solid #b51f24;">
    <h5 class="mb-0 fw-bold d-flex align-items-center gap-2">
      <span style="color: #b51f24;">üìÖ</span>
      Ventas por Semanas
    </h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead style="background: #000;">
          <tr>
            <th
              style="color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem;">
              Semana</th>
            <th
              style="color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem;">
              Total</th>
          </tr>
        </thead>
        <tbody>
          {% for w in weeks %}
          <tr>
            <td class="py-3">
              <span style="color: #e9e9e9;">{{ w.start }} <span style="color: #999;">‚Üí</span> {{ w.end }}</span>
            </td>
            <td class="py-3">
              <span class="fw-600" style="color: #b51f24; font-size: 1.05rem;">${{ w.total|floatformat:2 }}</span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="2" class="text-center py-4 text-muted">
              ‚ÑπÔ∏è No hay datos disponibles para el per√≠odo seleccionado
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Productos m√°s vendidos -->
<div class="card shadow-custom">
  <div class="card-header" style="background: #000; border-bottom: 2px solid #b51f24;">
    <h5 class="mb-0 fw-bold d-flex align-items-center gap-2">
      <span style="color: #b51f24;">üèÜ</span>
      Productos M√°s Vendidos
    </h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-hover mb-0">
        <thead style="background: #000;">
          <tr>
            <th
              style="color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem;">
              ID</th>
            <th
              style="color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem;">
              Producto</th>
            <th
              style="color: #fff; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.85rem; text-align: center;">
              Cantidad</th>
          </tr>
        </thead>
        <tbody>
          {% for row in top_products_page %}
          <tr>
            <td class="py-3">
              <span class="badge" style="background: #b51f24;">{{ row.producto.pk }}</span>
            </td>
            <td class="py-3">
              <span style="color: #e9e9e9;">{{ row.producto.nombre }}</span>
            </td>
            <td class="py-3 text-center">
              <span class="fw-600"
                style="color: #b51f24; background: rgba(181, 31, 36, 0.1); padding: 0.35rem 0.75rem; border-radius: 0.375rem;">
                {{ row.cantidad }}
              </span>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3" class="text-center py-4 text-muted">
              ‚ÑπÔ∏è No hay productos vendidos en este per√≠odo
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Paginaci√≥n mejorada -->
  {% if top_products_page.has_previous or top_products_page.has_next %}
  <div class="card-footer" style="background: #1a1a1a; border-top: 1px solid #2a2a2a;">
    <nav aria-label="Paginaci√≥n">
      <ul class="pagination mb-0 justify-content-center">
        {% if top_products_page.has_previous %}
        <li class="page-item">
          <a class="page-link"
            href="?page={{ top_products_page.previous_page_number }}&start={{ start }}&end={{ end }}">
            ‚Üê Anterior
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">‚Üê Anterior</span>
        </li>
        {% endif %}

        <li class="page-item disabled">
          <span class="page-link" style="color: #999;">
            P√°gina <strong style="color: #b51f24;">{{ top_products_page.number }}</strong> de <strong>{{
              top_products_page.paginator.num_pages }}</strong>
          </span>
        </li>

        {% if top_products_page.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ top_products_page.next_page_number }}&start={{ start }}&end={{ end }}">
            Siguiente ‚Üí
          </a>
        </li>
        {% else %}
        <li class="page-item disabled">
          <span class="page-link">Siguiente ‚Üí</span>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>
  {% endif %}
</div>

<!-- Estilos personalizados para este reporte -->
<style>
  .letter-spacing {
    letter-spacing: 0.5px;
  }

  .fw-600 {
    font-weight: 600;
  }

  .table-hover tbody tr:hover {
    background-color: rgba(181, 31, 36, 0.05) !important;
    border-left: 3px solid #b51f24;
    padding-left: 1rem;
  }

  .badge {
    animation: pulse 2s infinite;
  }

  @keyframes pulse {

    0%,
    100% {
      transform: scale(1);
    }

    50% {
      transform: scale(1.05);
    }
  }
</style>

{% endblock %}